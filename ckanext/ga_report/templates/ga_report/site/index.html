{% extends "/ga_report/site/layout_base.html" %}
{% import "/ga_report/ga_util.html" as m with context %}

{% block page_title %}Site usage{% endblock %}
{% block breadcrumbs %}
  <li><a href="{{h.url_for_static('site-usage')}}">Site Analytics</a></li>
  <li><a href="{{h.url_for_static('site-usage')}}">Site-wide</a></li>
{% endblock %}
{% block content %}
  <div class="row">
    <div class="col-sm-7 col-md-8 col-lg-9">
      {% with download_link=h.url_for(controller='ckanext.ga_report.controller:GaReport',action='csv',month=c.month or 'all') %}
        <a class="btn button btn-primary btn-sm pull-right" href="{{download_link}}"><i class="icon-download"></i>&nbsp; Download as CSV</a>
      {% endwith %}
      <h1>Site Usage</h1>
    </div>
    <div class="col-sm-5 col-md-4 col-lg-3">
      <div class="panel panel-default">
        <div class="panel-heading"><strong>Jump To...</strong></div>
        <div class="panel-body">
          <ul>
            <li><a href="{{h.url_for_static('/site-usage/publisher')}}">Publisher Usage Statistics</a></li>
            <li><a href="{{h.url_for_static('/site-usage/dataset')}}">Dataset Usage Statistics</a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
  <div class="row" style="background: #fff;">
    <div class="col-md-8">
      <div class="whitebox">
        <div class="tabbable">
          <ul class="nav nav-tabs">
            <li class="active"><a href="#totals" data-hash="totals" data-toggle="tab">Totals</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Browsers
              <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#browsers_names" data-hash="browsers_names" data-toggle="tab">Browsers</a></li>
                <li><a href="#browsers_versions" data-hash="browsers_versions" data-toggle="tab">Versions</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Operating Systems
              <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#os" data-hash="os" data-toggle="tab">Operating Systems</a></li>
                <li><a href="#os_versions" data-hash="os_versions" data-toggle="tab">Versions</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Social
              <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#social_networks" data-hash="social_networks" data-toggle="tab">All networks</a></li>
                <li><a href="#social_referrals_totals" data-hash="social_referrals_totals" data-toggle="tab">Referral links</a></li>
              </ul>
            </li>
            <li><a href="#languages" data-hash="languages" data-toggle="tab">Languages</a></li>
            <li><a href="#country" data-hash="country" data-toggle="tab">Country</a></li>
          </ul>
          <div class="tab-content">
            <div class="tab-pane active" id="totals">
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <table class="ga-reports-table table table-condensed table-bordered table-striped">
                <tr>
                  <th>Name</th>
                  <th class="td-numeric">Value</th>
                  <th>History</th>
                </tr>
                {% for name, value, graph in c.global_totals %}
                  <tr>
                    <td>{{name}}</td>
                    <td class="td-numeric">{{value}}</td>
                    <td class="sparkline-cell">
                      <span class="sparkline" sparkTooltips="{{h.join_x(graph)}}">
                        {{h.join_y(graph)}}
                      </span>
                    </td>
                  </tr>
                {% endfor %}
              </table>
            </div>
            <div class="tab-pane" id="browsers_versions">
              {{m.rickshaw_graph(c.browser_versions_graph,'browser-versions',mode='stack')}}
              <hr/>
              <p>Note: Where a browser has a large number of versions, these have been grouped together.</p>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.browser_versions)}}
            </div>
            <div class="tab-pane" id="browsers_names">
              {{m.rickshaw_graph(c.browsers_graph,'browsers',mode='stack')}}
              <hr/>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.browsers)}}
            </div>
            <div class="tab-pane" id="os">
              {{m.rickshaw_graph(c.os_graph,'os',mode='stack')}}
              <hr/>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.os)}}
            </div>
            <div class="tab-pane" id="os_versions">
              {{m.rickshaw_graph(c.os_versions_graph,'os_versions',mode='stack')}}
              <hr/>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.os_versions)}}
            </div>
            <div class="tab-pane" id="social_referrals_totals">
              <p>Number of visits that were referred from social networks</p>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              {{m.social_table(c.social_referrer_totals)}}
            </div>
            <div class="tab-pane" id="social_networks">
              {{m.rickshaw_graph(c.social_networks_graph, 'social_networks',mode='stack')}}
              <hr/>
              <p>Percentage of visits that were referred from these social networks</p>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.social_networks, 'Visits')}}
            </div>
            <div class="tab-pane" id="languages">
              {{m.rickshaw_graph(c.languages_graph,'languages',mode='stack')}}
              <hr/>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.languages)}}
            </div>
            <div class="tab-pane" id="country">
              {{m.rickshaw_graph(c.country_graph,'country',mode='stack')}}
              <hr/>
              <form class="form-inline" action="{{h.url_for(controller='ckanext.ga_report.controller:GaReport',action='index')}}" method="get">
                <h4 class="ga-reports-heading">Show stats table for:</h4>
                {{m.month_selector(c.month, c.months, c.day)}}
              </form>
              <hr/>
              {{m.stat_table(c.country)}}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="text/javascript">
    $(function(){
      CKAN.GA_Reports.bind_sparklines();
      CKAN.GA_Reports.bind_sidebar();
      CKAN.GA_Reports.bind_month_selector();
  });
  </script>
{% endblock %}
